<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=1200, height=2000, initial-scale=1.0" />
  <title>
    <%= lang==="th" ? "ตะกร้าอาหาร" : "Cart" %>
  </title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@500;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --ui: "Kanit", system-ui, -apple-system, "Noto Sans Thai", "Prompt", sans-serif;
      --bg: #0b0c0e;
      --panel: #121212;
      --ink: #e5e7eb;
      --ink-weak: #bfc3ca;
      --divider: rgba(255, 255, 255, .08);
      --brand: #10B34A;
      --accent1: #f0a24e;
      --accent2: #d88734;
      --brown: #4a2f1f;
      --radius-lg: 18px;
      --radius-xl: 24px;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--ui);
    }

    .stage {
      position: relative;
      width: 1200px;
      height: 2000px;
      overflow: hidden;
      border-radius: 18px;
      background:
        linear-gradient(180deg, rgba(0, 0, 0, .15), rgba(0, 0, 0, .65) 55%, rgba(0, 0, 0, .85)),
        url('/img/firstpage/BGHomepage.png') center/cover no-repeat;
      box-shadow: 0 40px 100px rgba(0, 0, 0, .7), inset 0 0 0 1px rgba(255, 255, 255, .06);
    }

    /* Topbar */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 20;
      height: 84px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(18, 18, 18, .9);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid var(--divider);
    }

    .topbar h1 {
      margin: 0;
      font-size: 42px;
      font-weight: 800;
      letter-spacing: .2px;
    }

    .topbar .back {
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      width: 56px;
      height: 56px;
      border-radius: 16px;
      display: grid;
      place-items: center;
      background: #1c1c1c;
      border: 1px solid var(--divider);
      color: #fff;
      text-decoration: none;
      font-size: 32px;
      line-height: 0;
      transition: transform .08s ease, filter .15s ease;
    }

    .topbar .back:hover {
      filter: brightness(1.15);
      transform: translateY(-50%) translateY(-1px);
    }

    /* Scroll container */
    .scroll-area {
      position: relative;
      height: calc(100% - 84px);
      overflow: hidden;
    }

    .container {
      height: 100%;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      padding: 18px 18px 200px 18px;
      /* เผื่อพื้นที่ให้ checkout bar ด้านล่าง */
    }

    /* Empty */
    .empty {
      margin: 120px auto;
      width: min(820px, 90%);
      text-align: center;
      color: var(--ink);
    }

    .empty h3 {
      font-size: 48px;
      margin: 0 0 10px;
      font-weight: 800;
      color: #fff;
    }

    .empty p {
      font-size: 28px;
      margin: 0 0 26px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      text-decoration: none;
      color: #fff;
      padding: 18px 28px;
      border-radius: 18px;
      font-weight: 800;
      font-size: 28px;
      letter-spacing: .3px;
      background: radial-gradient(160px 120px at 50% 0%, rgba(255, 255, 255, .18), rgba(255, 255, 255, 0) 70%),
        linear-gradient(180deg, var(--accent1), var(--accent2));
      border: 1px solid rgba(255, 255, 255, .08);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .06), 0 8px 20px rgba(0, 0, 0, .35);
      -webkit-tap-highlight-color: transparent;
      transition: transform .08s ease, filter .18s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
      filter: saturate(1.06);
    }

    /* List */
    .cart-list {
      display: flex;
      flex-direction: column;
      gap: 18px;
      max-width: 1040px;
      margin: 0 auto;
    }

    .cart-item {
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 18px;
      align-items: center;
      background: #141414;
      border: 1px solid var(--divider);
      border-radius: 22px;
      padding: 14px;
      box-shadow: 0 12px 24px rgba(0, 0, 0, .35);
    }

    .thumb {
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      border-radius: 18px;
      display: block;
      box-shadow: 0 6px 14px rgba(0, 0, 0, .35);
    }

    .info {
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .title {
      margin: 0;
      font-size: 36px;
      font-weight: 800;
    }

    .detail {
      margin: 0;
      color: var(--ink-weak);
      font-size: 24px;
    }

    .opts {
      margin: 0;
      padding-left: 22px;
      color: var(--ink-weak);
      font-size: 22px;
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 18px;
    }

    /* Stepper (ใช้ฟอร์มเดิม) */
    .stepper {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .qty {
      min-width: 44px;
      text-align: center;
      font-size: 30px;
      font-weight: 800;
    }

    .qty-btn {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 1px solid var(--divider);
      color: #fff;
      background: #1e1e1e;
      display: grid;
      place-items: center;
      font-size: 30px;
      font-weight: 900;
      line-height: 0;
      cursor: pointer;
      transition: transform .08s ease, filter .18s ease;
    }

    .qty-btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
    }

    .qty-btn.plus {
      background: radial-gradient(90px 60px at 50% 0%, rgba(255, 255, 255, .18), rgba(255, 255, 255, 0) 70%),
        linear-gradient(180deg, var(--accent1), var(--accent2));
      border: 1px solid rgba(255, 255, 255, .08);
    }

    .line-price {
      font-size: 32px;
      font-weight: 800;
    }

    .remove {
      margin-top: 6px;
    }

    .remove-btn {
      background: transparent;
      border: 0;
      color: #ffb4b4;
      font-weight: 700;
      font-size: 22px;
      cursor: pointer;
      padding: 8px 0;
      text-decoration: underline dotted rgba(255, 255, 255, .25);
    }

    /* Checkout bar */
    .checkout {
      position: absolute;
      left: 18px;
      right: 18px;
      bottom: 18px;
      background: var(--brown);
      border-radius: 20px;
      padding: 18px 22px;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      border: 1px solid rgba(255, 255, 255, .06);
      box-shadow: 0 -2px 0 rgba(0, 0, 0, .25);
    }

    .sum {
      display: flex;
      align-items: baseline;
      gap: 12px;
    }

    .sum .label {
      font-size: 26px;
      color: #f1e9e1;
    }

    .sum .value {
      font-size: 40px;
      font-weight: 800;
    }

    .pay-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
      color: #fff;
      text-decoration: none;
      height: 64px;
      padding: 0 32px;
      border-radius: 16px;
      font-weight: 800;
      letter-spacing: .5px;
      text-transform: uppercase;
      font-size: 28px;
      background: radial-gradient(160px 120px at 50% 0%, rgba(255, 255, 255, .18), rgba(255, 255, 255, 0) 70%),
        linear-gradient(180deg, var(--accent1), var(--accent2));
      border: 1px solid rgba(255, 255, 255, .08);
      -webkit-tap-highlight-color: transparent;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .06), 0 10px 22px rgba(0, 0, 0, .35);
      transition: transform .08s ease, filter .18s ease;
    }

    .pay-btn:hover {
      transform: translateY(-1px);
      filter: saturate(1.06);
    }

    /* ตัวเลขคมเท่ากัน */
    .line-price,
    .sum .value {
      font-variant-numeric: tabular-nums;
      font-feature-settings: "tnum" 1, "lnum" 1;
    }
  </style>
</head>

<body>
  <main class="stage">
    <header class="topbar">
      <a href="/main" class="back" aria-label="<%= lang==='th' ? 'กลับ' : 'Back' %>">‹</a>
      <h1>
        <%= lang==="th" ? "ตะกร้าอาหาร" : "Cart" %>
      </h1>
    </header>

    <section class="scroll-area">
      <div class="container">

        <% if (data.length===0) { %>

          <div class="empty">
            <h3>
              <%= lang==="th" ? "ยังไม่มีสินค้าในตะกร้า" : "Your cart is empty" %>
            </h3>
            <p>
              <%= lang==="th" ? "ไปเลือกเมนูอร่อย ๆ กันก่อนนะ" : "Browse the menu and add something tasty!" %>
            </p>
            <a class="btn" href="/main">
              <span>
                <%= lang==="th" ? "ไปหน้าเมนู" : "Browse menu" %>
              </span>
            </a>
          </div>

          <% } else { %>

            <% let total=0; %>
              <div class="cart-list">
                <% data.forEach(function(item, idx){ const line=(item.final_price * item.quantity); total +=line; %>

                  <article class="cart-item">
                    <img class="thumb" src="/img/menu/<%= item.category_id %>/<%= item.name_eng %>.png"
                      alt="<%= item.name_thai %>">

                    <div class="info">
                      <h3 class="title">
                        <%= item.name %>
                      </h3>
                      <% if (item.detail){ %>
                        <p class="detail">
                          <%= item.detail %>
                        </p>
                        <% } %>

                          <% if (item.options && item.options.length){ %>
                            <ul class="opts">
                              <% item.options.forEach(function(opt){ %>
                                <li>
                                  <%= opt.name %>
                                    <% if(opt.extra_price>0){ %>(+฿<%= opt.extra_price %>)<% } %>
                                </li>
                                <% }) %>
                            </ul>
                            <% } %>

                            <% if (item.note) { %>
                              <p class="detail"><%= lang==="th" ? "โน็ต : " : "Note : " %><%= item.note %>
                              </p>
                            <% } %>

                              <div class="row">
                                <div class="stepper">
                                  <!-- decrease -->
                                  <form action="/cart/update" method="POST">
                                    <input type="hidden" name="index" value="<%= idx %>">
                                    <input type="hidden" name="action" value="decrease">
                                    <button type="submit" class="qty-btn">−</button>
                                  </form>

                                  <span class="qty">
                                    <%= item.quantity %>
                                  </span>

                                  <!-- increase -->
                                  <form action="/cart/update" method="POST">
                                    <input type="hidden" name="index" value="<%= idx %>">
                                    <input type="hidden" name="action" value="increase">
                                    <button type="submit" class="qty-btn plus">+</button>
                                  </form>
                                </div>

                                <div class="line-price">฿ <%= line %>
                                </div>
                              </div>

                              <form class="remove" action="/cart/remove" method="POST">
                                <input type="hidden" name="index" value="<%= idx %>">
                                <button type="submit" class="remove-btn">
                                  <%= lang==="th" ? "ลบออก" : "Remove" %>
                                </button>
                              </form>
                    </div>
                  </article>

                  <% }) %>
              </div>

              <!-- Checkout summary -->
              <div class="checkout">
                <div class="sum">
                  <span class="label">
                    <%= lang==="th" ? "ยอดรวม" : "Total" %>
                  </span>
                  <span class="value">฿ <%= total %></span>
                </div>
                <a class="pay-btn" href="/payment">
                  <%= lang==="th" ? "ชำระเงิน" : "Pay now" %>
                </a>
              </div>

              <% } %>
      </div>
    </section>
  </main>
</body>

</html>